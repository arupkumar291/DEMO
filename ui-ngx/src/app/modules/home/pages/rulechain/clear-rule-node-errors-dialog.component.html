<!--

    Copyright Â© 2016-2023 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<section style="min-width: 480px;">
  <mat-toolbar fxFlex fxLayoutAlign="center center" color="accent-dark">
    <h2>{{'rulenode.clear-node-errors-title' | translate }}</h2>
  </mat-toolbar>
  <mat-progress-bar color="warn" mode="indeterminate" *ngIf="isLoading$ | async">
  </mat-progress-bar>
  <div style="padding: 8px 24px 8px 24px">
    <div style="height: 4px;" *ngIf="!(isLoading$ | async)"></div>
    <section class="message-details">
      <span>{{'rulenode.node-name' | translate}}: {{node.name}}</span>
      <span fxFlex></span>
      <button matTooltip="{{ 'rulenode.last-message-data' | translate }}" (click)="showData($event)">
        &#123; {{'event.data' | translate}} &#125;
      </button>
      <button matTooltip="{{ 'rulenode.last-message-metadata' | translate }}" (click)="showMetadata($event)">
        &#123; {{'event.metadata' | translate}} &#125;
      </button>
    </section>
    <section class="logged-errors" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="4px">
      <span>{{ translate.get('rulenode.errors-count', {count: node.stats.errorsCount}) | async }}</span>
      <span>{{ 'rulenode.since-last-acknowledge' | translate }}</span>
      <a aria-label="View on dashboard" (click)="viewOnDashboard($event)">{{ 'rulenode.view-on-dashboard' | translate }} &#8594;</a>
    </section>
    <span class="last-message-title">{{ 'rulenode.last-error-message-title' | translate }}:</span>
    <section class="last-message-text">
      <textarea disabled #lastMessage matInput cdkTextareaAutosize cols="1" cdkAutosizeMinRows="1"></textarea>
    </section>
    <div class="dialog-actions" mat-dialog-actions fxLayoutAlign="end center" style="padding-top: 16px;">
      <button mat-button cdkFocusInitial
              (click)="cancel()" [disabled]="isLoading$ | async">
        {{ 'action.cancel' | translate }}
      </button>
      <button mat-raised-button color="accent-dark"
              (click)="acknowledge()" [disabled]="isLoading$ | async">
        {{ 'rulenode.acknowledge' | translate }}
      </button>
    </div>
  </div>
</section>
